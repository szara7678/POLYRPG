(function(){"use strict";function i(a){if(a.morale<.25){const s=Math.atan2(a.z,a.x)+Math.PI,e=1.6;return{vx:Math.cos(s)*e,vz:Math.sin(s)*e,action:"FLEE"}}const n=Math.random()*Math.PI*2,o=1.2;return{vx:Math.cos(n)*o,vz:Math.sin(n)*o,action:"PATROL"}}self.onmessage=a=>{const n=a.data;if(n.cmd==="init"){self.postMessage({ok:!0});return}if(n.cmd==="step"){const o=new Uint32Array(n.ids),s=new Float32Array(n.data),e=o.length,c=new Float32Array(e*2);for(let t=0;t<e;t++){o[t];const d=s[t*3+0],f=s[t*3+1],l=s[t*3+2],r=i({x:d,z:f,morale:l});c[t*2+0]=r.vx,c[t*2+1]=r.vz}self.postMessage({vels:c},[c.buffer])}}})();
